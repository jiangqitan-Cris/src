# Local Planner 配置文件 (ROS2 参数格式)

local_planner_node:
  ros__parameters:
    # ========================================================================
    #                            坐标系配置
    # ========================================================================
    global_frame: "map"
    robot_frame: "base_link"
    
    # ========================================================================
    #                            底盘模型配置
    # ========================================================================
    chassis_model_type: "ackermann"  # 底盘模型类型: "ackermann", "differential", "omniwheel"
                                      # - ackermann: 阿克曼底盘，航向差异大时倒车调整
                                      # - differential: 差速底盘，航向差异大时原地掉头
                                      # - omniwheel: 全向轮底盘，无需特殊机动
    
    # ========================================================================
    #                            规划器配置
    # ========================================================================
    planning_frequency: 10.0        # 规划频率 (Hz)
    local_range: 5.0                # 局部障碍物提取范围 (m)
    lookahead_distance: 5.0         # 参考路径前视距离 (m)
    obstacle_radius: 0.15           # 障碍物等效半径 (m)
    obstacle_threshold: 50          # 障碍物阈值 (0-100)
    obstacle_cluster_dist: 0.3      # 障碍物聚类距离 (m)
    visualize_lattice: true         # 是否可视化 Lattice 候选轨迹
    planner_type: "ilqr"            # 局部规划算法: "lattice" 或 "ilqr"
    goal_tolerance: 0.1             # 到达终点的容差 (m)
    
    # ========================================================================
    #                         Lattice Planner 配置
    # ========================================================================
    lattice:
      num_width_samples: 11          # 横向采样数量
      num_time_samples: 10           # 时间采样数量
      max_lateral_offset: 1.0       # 最大横向偏移 (m)
      min_planning_time: 2.0        # 最小规划时间 (s)
      max_planning_time: 4.0        # 最大规划时间 (s)
      time_resolution: 0.1          # 时间分辨率 (s)
      safe_distance: 0.2            # 障碍物安全距离/膨胀半径 (m)，调小可在狭窄空间通行
      weight_lateral_offset: 5.0    # 横向偏移代价权重，越大越沿着全局路径走
      weight_deviation: 10.0        # 偏离参考路径的惩罚权重
    
    # ========================================================================
    #                            车辆参数
    # ========================================================================
    vehicle:
      wheelbase: 0.32               # 轴距 (m)
      width: 0.3                    # 车宽 (m)
      max_speed: 1.0                # 最大速度 (m/s)
      max_acceleration: 1.0         # 最大加速度 (m/s²)
      max_steering_angle: 0.5       # 最大前轮转角 (rad)
      max_curvature: 1.7            # 最大曲率 (1/m)
    
    # ========================================================================
    #                            iLQR 配置
    # ========================================================================
    ilqr:
      max_iterations: 50
      tolerance: 0.0001
      initial_lambda: 1.0
      horizon_time: 3.0
      dt: 0.1
      weight_x: 1.0
      weight_y: 1.0
      weight_theta: 0.5
      weight_v: 0.1
      weight_acceleration: 0.1
      weight_steering: 0.1
      weight_terminal: 10.0
      weight_obstacle: 50.0      # 障碍物排斥权重，越大越绕开障碍物
      safe_distance: 0.5         # 安全距离 (m)
